
stages:
  - debug
  - release

variables:
  version: "2018.7.13.3291"

debug:
  stage: debug
  only:
  - debug
  script:
  - call "C:\Program Files (x86)\Microsoft Visual Studio\2017\Enterprise\Common7\Tools\VsDevCmd.bat"
  - dotnet build "Bhbk.Lib.Core.sln" --configuration Debug
  - dotnet test "Bhbk.Lib.Helpers.Tests\Bhbk.Lib.Helpers.Tests.csproj" --configuration Debug
  - dotnet test "Bhbk.Lib.Waf.Tests\Bhbk.Lib.Waf.Tests.csproj" --configuration Debug

release:
  stage: release
  only:
  - debug
  script:
  - call "C:\Program Files (x86)\Microsoft Visual Studio\2017\Enterprise\Common7\Tools\VsDevCmd.bat"
  - dotnet build "Bhbk.Lib.Core.sln" --configuration Release
  - dotnet pack "Bhbk.Lib.Helpers\Bhbk.Lib.Helpers.csproj" --configuration Release -p:PackageVersion=$version --output "..\\" -p:TargetFrameworks=netstandard2.0
  - dotnet pack "Bhbk.Lib.Waf\Bhbk.Lib.Waf.csproj" --configuration Release -p:PackageVersion=$version --output "..\\" -p:TargetFrameworks=netstandard2.0
  - dotnet nuget push *.nupkg --api-key %NUGET_FEED_KEY% --source %NUGET_FEED_URL%
